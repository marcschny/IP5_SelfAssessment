# This file is a template, and might need editing before it works on your project.
# https://hub.docker.com/r/google/dart
image: google/dart:2.8.4


variables:
  # Use to learn more:
  # pub run test --help
  PUB_VARS: "--platform vm --timeout 30s --concurrency=6 --test-randomize-ordering-seed=random --reporter=expanded"

  ANDROID_COMPILE_SDK: "30"
  #ANDROID_BUILD_TOOLS: "28.0.2"
  #ANDROID_SDK_TOOLS:   "4333796"

stages:
    - test
    - build

# Cache downloaded dependencies and plugins between builds.
# To keep cache across branches add 'key: "$CI_JOB_NAME"'
cache:
  paths:
    - .pub-cache/global_packages

before_script:
  - apt-get --quiet update --yes
  - apt-get --quiet install --yes wget tar unzip lib32stdc++6 lib32z1 git
#  - wget --quiet --output-document=android-sdk.zip https://dl.google.com/android/repository/sdk-tools-linux-$%7BANDROID_SDK_TOOLS%7D.zip
#  - unzip -d android-sdk-linux android-sdk.zip
#  - echo y | android-sdk-linux/tools/bin/sdkmanager "platforms;android-${ANDROID_COMPILE_SDK}" >/dev/null
#  - echo y | android-sdk-linux/tools/bin/sdkmanager "platform-tools" >/dev/null
#  - echo y | android-sdk-linux/tools/bin/sdkmanager "build-tools;${ANDROID_BUILD_TOOLS}" >/dev/null
#  - export ANDROID_HOME=$PWD/android-sdk-linux
#  - export PATH=$PATH:$PWD/android-sdk-linux/platform-tools/
  # chmod +x ./gradlew
  # temporarily disable checking for EPIPE error and use yes to accept all licenses
  - git clone https://github.com/flutter/flutter.git -b stable --depth 1
  - export PATH="$PATH:pwd/flutter/bin"
  - export PATH="$PATH:pwd/flutter/bin/cache/dart-sdk/bin"
  - set +o pipefail
  - yes | android-sdk-linux/tools/bin/sdkmanager --licenses
  - set -o pipefail

debugTests:
  stage: test
  script:
    - flutter pub get
    - flutter packages pub run IP5_GitLab-Runner build
    - flutter test
    - cd /builds/alexander.eser/ip5_selbsteinschaetzung
    #- dart --enable-asserts --enable-vm-service:59314 /builds/ip34-20bb/ip34-20bb_selfassessmentyouthapp/dateien/test/code_metrics_analyzer.dart
  artifacts:
    paths:
      - metrics/


assembleDebug:
  stage: build
  script:
    - flutter pub get
    - flutter packages pub run IP5_GitLab-Runner build
    - flutter build apk
  artifacts:
    paths:
      - build/app/outputs/






